!function(e,t,o){"use strict";function i(e){if(s){if(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),!navigator.enumerateDevices)return void(e&&e());a=[],navigator.enumerateDevices(function(t){t.forEach(function(e){var t={};for(var o in e)t[o]=e[o];"audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput");var i;a.forEach(function(e){e.id===t.id&&e.kind===t.kind&&(i=!0)}),i||(t.deviceId||(t.deviceId=t.id),t.id||(t.id=t.deviceId),t.label?("videoinput"!==t.kind||g||(g=!0),"audioinput"!==t.kind||p||(p=!0)):(t.label="Please invoke getUserMedia once.",c||(t.label="HTTPs is required to get label of this "+t.kind+" device.")),"audioinput"===t.kind&&(d=!0),"audiooutput"===t.kind&&(u=!0),"videoinput"===t.kind&&(h=!0),a.push(t))}),e&&e()})}}e||console.warn("Proctor: No library found. Use jQuery or MLIB");var n,r;n={integrityScore:100,ignoreRecording:!1,ignoreTrack:!1,video:"#proctor-canvas",cavnas:"#proctor-canvas",onFaceTracked:function(){},onMultiFaceTracked:function(){},takeInitialSnapshot:!1,handleSnapshot:function(e){},onAmbientNoiseDetection:function(){},handleOutdatedBrowser:function(){},onMicPermissionDenied:function(){},onCamPermissionDenied:function(){},proctorReady:function(){}},navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(e){navigator.mediaDevices.enumerateDevices().then(e)});var a=[],c="https:"===location.protocol,s=!1;"undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?s=!0:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(s=!0);var d=!1,u=!1,h=!1,p=!1,g=!1;r=function(t){return this.opts=e.extend({},n,t),this.opts.takeInitialSnapshot&&(this.initialSnap=!1),this.$video=e(this.opts.video),this.video=this.$video[0],this.$canvas=e(this.opts.canvas),this.canvas=this.$canvas[0],this.video&&this.canvas||this.opts.ignoreTrack?this.init():console.warn("Proctor: Video or Canvas not found")},r.prototype.init=function(){var e=this;return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,i(function(){return h?d?!e.opts.ignoreRecording&&!navigator.getUserMedia||!e.opts.ignoreRecording&&!Recorder.isRecordingSupported()?e.opts.handleOutdatedBrowser():(!g&&!e.opts.ignoreTrack&&console.warn("Proctor: Webcam needed to work"),!p&&!e.opts.ignoreRecording&&console.warn("Proctor: Microphone needed to work"),!g&&!e.opts.ignoreTrack||!p&&!e.opts.ignoreRecording?navigator.getUserMedia({audio:!0,video:!0},function(t){e.proctor()},function(e){}):void e.proctor()):console.log("Proctor: Microphone not found"):console.log("Proctor: Webcam not found")}),this},r.prototype.proctor=function(){!this.opts.ignoreTrack&&this.beginTrack(),!this.opts.ignoreRecording&&this.prepareRecorder(),this.beginAudioTracking()},r.prototype.beginTrack=function(){var e=this,t=e.context=this.canvas.getContext("2d"),o=new tracking.ObjectTracker("face");o.setInitialScale(4),o.setStepSize(1),o.setEdgesDensity(.1),tracking.track(this.video,o,{camera:!0}),o.on("track",function(o){t.clearRect(0,0,e.canvas.width,e.canvas.height),!e.trackerReady&&(e.trackerReady=!0,e.setProctorReady()),0===o.data.length||o.data.forEach(function(t){e.onFaceTracked(t),o.data.length>1&&e.onMultiFaceTracked(t)})})},r.prototype.onFaceTracked=function(e){this.context.strokeStyle="rgba(255, 255, 255, .8)",this.context.font="11px Helvetica",this.context.fillStyle="#fff",this.context.strokeRect(e.x,e.y,e.width,e.height),this.context.fillText("x: "+e.x+"px",e.x+e.width+5,e.y+11),this.context.fillText("y: "+e.y+"px",e.x+e.width+5,e.y+22),this.initialSnap===!1&&(this.takeSnapShot(e),this.initialSnap=!0)},r.prototype.onMultiFaceTracked=function(e){this.takeSnapShot(e),this.opts.onMultiFaceTracked()},r.prototype.takeSnapShot=function(e){this.context.drawImage(this.video,0,0,640,360),this.opts.handleSnapshot(this.canvas.toDataURL("image/jpeg",1))},r.prototype.beginAudioTracking=function(){function t(e){o.$meter[0]&&(o.$meter.css({width:o.meterWidth+"px",height:o.meterHeight+"px"}),o.meter.checkClipping()?o.$meter.css({background:"red"}):o.$meter.css({background:"green"}),o.$meter.css({width:o.meter.volume*o.meterWidth*1.4+"px"}));var i=100*o.meter.volume;i>=5&&(o.recorder.start(),o.opts.onAmbientNoiseDetection(),setTimeout(function(){o.recorder.stop()},5e3)),console.log("Proctor: Pitch -> "+i),o.rafID=window.requestAnimationFrame(t)}var o=this;this.audioContext=null,this.meter=null,this.meterWidth=500,this.meterHeight=50,this.rafID=null,this.mediaStreamSource,this.$meter=e("#vol-meter"),window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext;try{navigator.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}},function(e){console.log("Proctor: Listening"),o.mediaStreamSource=o.audioContext.createMediaStreamSource(e),o.meter=createAudioMeter(o.audioContext),o.mediaStreamSource.connect(o.meter),t()},function(e){})}catch(i){console.log("Proctor: getUserMedia threw exception :"+i)}},r.prototype.prepareRecorder=function(){var e=this;e.recorderReady=!1,this.recorder=new Recorder({monitorGain:parseInt(0,10),numberOfChannels:parseInt(1,10),wavBitDepth:parseInt(16,10),encoderPath:"js/waveWorker.min.js"}),this.recorder.addEventListener("start",function(e){console.log("Proctor: Recorder is started")}),this.recorder.addEventListener("stop",function(e){console.log("Proctor: Recorder is stopped")}),this.recorder.addEventListener("pause",function(e){console.log("Proctor: Recorder is paused")}),this.recorder.addEventListener("resume",function(e){console.log("Proctor: Recorder is resuming")}),this.recorder.addEventListener("streamError",function(e){console.log("Proctor: Error encountered: "+e.error.name)}),this.recorder.addEventListener("streamReady",function(t){e.recorderReady=!0,e.setProctorReady(),console.log("Proctor: Audio stream is ready.")}),this.recorder.addEventListener("dataAvailable",function(t){var o=new Blob([t.detail],{type:"audio/wav"}),i=new window.FileReader;i.readAsDataURL(o),i.onloadend=function(){var t=i.result;e.opts.handleAudio(t)}}),this.recorder.initStream()},r.prototype.setProctorReady=function(){var e=!1;e=!this.opts.ignoreRecording&&this.recorderReady?!0:!1,e=!this.opts.ignoreTrack&&this.trackerReady?!0:!1,e&&this.opts.proctorReady()},t.Proctor=r}("undefined"!=typeof jQuery&&jQuery,window,document),function(){var e=100;new Proctor({ignoreRecording:!1,ignoreTrack:!1,video:"#proctor-video",canvas:"#proctor-canvas",takeInitialSnapshot:!0,handleOutdatedBrowser:function(){alert("Update your browser ma niggah")},handleSnapshot:function(e){$.ajax({type:"POST",url:"upload_snapshot.php",data:{imgBase64:e},success:function(e){},error:function(){}}).done(function(e){})},handleAudio:function(e){$.ajax({type:"POST",url:"upload_audio.php",data:{data:e},success:function(e){},error:function(){}}).done(function(e){})},onFaceTracked:function(){},onMultiFaceTracked:function(){e-=15},onAmbientNoiseDetection:function(){e-=5},onMicPermissionDenied:function(){console.log("Proctor: Microphone needed for this test")},onCamPermissionDenied:function(){console.log("Proctor: Webcam needed for this test")},proctorReady:function(){console.log("Proctor is ready.")}})}();